extend ../default2
block mainContent

	.slide(data-index=0)
		.arrowr.arrow(onclick="forward()")
		.arrowl.arrow(onclick="backward()")
		.slidemarker
	.box.menu
		a(href="/mat")
			.container
				p.mat.reg 
				p.mat.veg 

	- var slides = [{text:'hej',bild:'/images/insta.jpg',link:'http://youtube.com'}, {text:'2',bild:"/images/W_2013_199.png", link:'http://twitter.com'}, {text:'Pepparkakor',bild:"/images/WP_Meta_IV-3840x2160_00249.png", link:'http://facebook.com'}]

	- var boxes = [{bild:'/images/instagram/bulle.jpg', link:'http://facebook.com', text:'Det är kanelbullens dag snart!'}, {bild:"/images/instagram/hobbit.png", link:'http://facebook.com', text:'På onsdag sak ni klä ut er igen'}, {bild:"/images/instagram/julklapp.jpg", link:'http://facebook.com', text:'Det är jul snart och då vill folk ha klappar'}, {bild:"/images/instagram/suitup.png", link:'http://facebook.com', text:'Fina kläder är bra'}, {bild:"/images/instagram/tävling.png", link:'http://facebook.com', text:'Det är tävling snart'}, {bild:"/images/instagram/vrofonden.png", link:'http://facebook.com', text:'Om du har lite pengar kan du nu komma till oss!'}]

	script.
		document.getElementsByTagName("BODY")[0].style.backgroundColor = '#e6e6e6'
		function addplane(){
			var plane = _('.addplane')
			var dark = _('.darkBackground')
			plane.style.display = plane.style.display === 'block' ? 'none' : 'block'
			dark.style.display = dark.style.display === 'block' ? 'none' : 'block'
		}

		function cleanPlane(){
			_('.imageinput').src = _('.titleinput').value = _('.bodyinput').value = ''
		}
		function addBox(){

		}

		function foodLoadingError(err) {
			// TODO: Show in UI
			console.error({api:'food', err:err})}

		api.food(function(err, weeks) {
			if (err) return foodLoadingError(err)
		
			var currentWeekNr = (new Date()).getWeek()
			var weekIndex = weeks.findIndex(function(week) {return week.nr==currentWeekNr})
			if (weekIndex<0) return foodLoadingError('Current week wasn\'t found')

			// Select day, monday next week if weekend
			var currentDayOfWeek = (new Date()).getDay()
			var isWeekend = currentDayOfWeek==0 || currentDayOfWeek==6
			if (isWeekend) {
				currentDayOfWeek = 1
				weekIndex++
				if (weekIndex>=weeks.length) return foodLoadingError('Next week wasn\'t found') }
			var week = weeks[weekIndex]

			var day = week.days.find(function(day) {return day.nr==currentDayOfWeek})
			if (!day) return foodLoadingError('Current day wasn\'t found') 

			_('.reg').innerText = day.courses.main
			_('.veg').innerText = day.courses.veg
		})

		var slides = JSON.parse('!{JSON.stringify(slides)}')
		var boxes = JSON.parse('!{JSON.stringify(boxes)}')

		var arrayLength = slides.length
		var boxLength = boxes.length
		var temp
		var pluppdia = 8
		var bredd = window.innerWidth || document.documentElement.clientWidth || document.getElementsByTagName('body')[0].clientWidth

		for (i = 0; i < arrayLength; i++) {
			var slide = slides[i]
			temp = document.createElement('div')
			temp.className ="slideobject"
			temp.style.backgroundImage = "url(" + slide.bild + ")"
			temp.style.left = i * 100 + "%"
			temp.setAttribute("onclick", "window.location.href = '" + slide.link + "'")


			text = document.createElement('h1')
			text.className = "bildtext"
			temp.appendChild(text)
			text.innerHTML = slide.text

			plupp = document.createElement('div')
			plupp.className = "plupp"
			plupp.className += " plupp" + i
			_(".slidemarker").appendChild(plupp)


			_(".slide").appendChild(temp)
		}

		for (q = 0; q < boxLength; q++){

			//- box = document.createElement('div')
			//- box.className ="box"
			//- box.setAttribute("onclick", "window.location.href = '" + boxes[q].link + "'")
			//- _(".main-content").appendChild(box)

			//- image = document.createElement('div')
			//- image.className ="boximage"
			//- image.style.backgroundImage = "url(" + boxes[q].bild + ")"
			//- image.setAttribute("onclick", "window.location.href = '" + boxes[q].link + "'")
			//- box.appendChild(image)

			//- text = document.createElement('p')
			//- text.className ="boxtext"
			//- text.setAttribute("onclick", "window.location.href = '" + boxes[q].link + "'")
			//- text.innerHTML = boxes[q].text
			//- box.appendChild(text)

			box = document.createElement('div')
			box.className ="utskottruta box"
			addTapEvent(box,showpost)
			_(".main-content").appendChild(box)

			upper = document.createElement('div')
			upper.className ="utskotttop boxtop"
			box.appendChild(upper)

			bild = document.createElement('div')
			bild.className ="utskottbild boxbild"
			bild.style.backgroundImage = "url(" + boxes[q].bild + ")"
			upper.appendChild(bild)

			text = document.createElement('div')
			text.className = "boxtext"
			text.innerText = boxes[q].text
			box.appendChild(text)

			if(i % 4 === 0){
				box.style.marginRight = '0px'
			}
		}

		function showpost(){
			document.getElementsByTagName("body")[0].className += ' dark-body'
			_('.postPlane').className += ' show-plane'
		}
		
		var n = 0
		var ticket = setInterval(function next() {
				n++
				if(n > (arrayLength - 1)){
					n = 0
				}
				_('.slide').dataset.index = n

				pluppar()

		}, 5000)

		function pluppar(){
			var active = ".plupp" + n
			var k = n-1

			if (k<0){
				k = arrayLength - 1
				}

			var inactive = ".plupp" + k
			_(inactive).style.backgroundColor = "rgba(255, 255, 255, 0)"
			_(active).style.backgroundColor = "white"
		}

		function plupparbak(){
			var active = ".plupp" + n
			_(active).style.backgroundColor = "white"

			var k = n + 1

			if (k > arrayLength - 1){
				k = 0
			}

			var inactive = ".plupp" + k
			_(inactive).style.backgroundColor = "rgba(255, 255, 255, 0)"
			
		}

		function forward(){
			n++
			if(n > (arrayLength - 1)){
				n = 0
			}
			_('.slide').dataset.index = n
			clearTimeout(ticket)
			pluppar()
		}

		function backward(){
			n = n -1
			if(n < 0){
				n = arrayLength - 1
			}
			_('.slide').dataset.index = n
			clearTimeout(ticket)
			plupparbak()
		}

		_('.main-content').style.background = 'none'
		_('.main-content').style.boxShadow = 'none'

		box = document.createElement('div')
		box.className ="utskottruta box menu addbox"
		addTapEvent(box,showadd)
		_(".main-content").appendChild(box)

		add = document.createElement('div')
		add.className ="addplusdiv"
		box.appendChild(add)

		function showadd(){
			document.getElementsByTagName("body")[0].className += ' dark-body'
			_('.addplane').className += ' show-plane'
		}